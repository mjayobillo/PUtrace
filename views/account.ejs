<%- include('_header') %>

<section class="card">
  <div style="display:flex;align-items:center;gap:1.5rem;margin-bottom:1.5rem;flex-wrap:wrap;">
    <div class="account-avatar"><%= currentUser.full_name.charAt(0).toUpperCase() %></div>
    <div>
      <h2 style="margin-bottom:0.2rem;"><%= currentUser.full_name %></h2>
      <p style="color:#888;font-size:0.9rem;"><%= currentUser.email %></p>
    </div>
  </div>

  <div class="account-grid">
    <div>
      <h3>Profile Information</h3>
      <div class="info-row">
        <span class="info-label">Full Name</span>
        <span class="info-value"><%= currentUser.full_name %></span>
      </div>
      <div class="info-row">
        <span class="info-label">Email</span>
        <span class="info-value"><%= currentUser.email %></span>
      </div>
      <div class="info-row">
        <span class="info-label">Member Since</span>
        <span class="info-value"><%= new Date(createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></span>
      </div>
    </div>

    <div>
      <h3>Update Profile</h3>
      <form method="post" action="/account">
        <label>Full name <input name="full_name" value="<%= currentUser.full_name %>" required /></label>
        <button type="submit" class="btn-sm">Save Changes</button>
      </form>

      <hr style="margin:1.5rem 0;border:none;border-top:1px solid #f0f2f5;">

      <h3>Change Password</h3>
      <form method="post" action="/account/password">
        <label>Current password
          <div class="password-wrap">
            <input type="password" name="current_password" id="currentPassword" required />
            <span class="pw-toggle" onclick="togglePassword('currentPassword', this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();togglePassword('currentPassword', this)}" title="Show password" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></span>
          </div>
        </label>
        <label>New password <small style="font-weight:400;color:#aaa;">(min 8 chars)</small>
          <div class="password-wrap">
            <input type="password" name="new_password" id="newPassword" required minlength="8" />
            <span class="pw-toggle" onclick="togglePassword('newPassword', this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();togglePassword('newPassword', this)}" title="Show password" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></span>
          </div>
        </label>
        <label>Confirm new password
          <div class="password-wrap">
            <input type="password" name="confirm_new_password" id="confirmNewPassword" required minlength="8" />
            <span class="pw-toggle" onclick="togglePassword('confirmNewPassword', this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();togglePassword('confirmNewPassword', this)}" title="Show password" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></span>
          </div>
        </label>
        <button type="submit" class="btn-sm">Update Password</button>
      </form>
      <form method="post" action="/account/password/reset-link" style="margin-top:0.75rem;">
        <button type="submit" class="btn-sm btn-outline">Send Password Reset Link</button>
      </form>
    </div>
  </div>
</section>

<section class="card">
  <h3>Quick Stats</h3>
  <div class="stats-bar">
    <div class="stat-card">
      <div class="stat-number"><%= itemCount %></div>
      <div class="stat-label">Items Registered</div>
    </div>
    <div class="stat-card">
      <div class="stat-number"><%= openReports %></div>
      <div class="stat-label">Open Reports</div>
    </div>
    <div class="stat-card">
      <div class="stat-number"><%= resolvedReports %></div>
      <div class="stat-label">Resolved</div>
    </div>
  </div>
</section>

<%- include('_footer') %>
