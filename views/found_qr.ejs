<%- include('_header') %>

<section class="found-hero">
  <div style="font-size:3rem;margin-bottom:0.5rem;">‚úÖ</div>
  <h2>You Found: <%= item.item_name %></h2>
  <p>Thank you for being awesome! Here's how to return this item.</p>
</section>

<section class="card">
  <h3>üì¶ Item Details</h3>
  <% if (item.image_url) { %>
    <div class="item-image-wrap" style="margin-bottom:1rem;">
      <img src="<%= item.image_url %>" alt="<%= item.item_name %>" class="item-image" style="max-width:300px;" />
    </div>
  <% } %>
  <p style="color:#666;margin-bottom:1rem;"><%= item.item_description || 'No description available.' %></p>

  <h3>üë§ Owner Information</h3>
  <div class="owner-info">
    <div class="owner-info-item">
      <strong>Name:</strong>&nbsp; <%= owner.full_name %>
    </div>
    <div class="owner-info-item">
      <strong>Email:</strong>&nbsp; <a href="mailto:<%= owner.email %>"><%= owner.email %></a>
    </div>
  </div>

  <hr style="margin:1.5rem 0;border:none;border-top:1px solid #f0f2f5;">

  <h3>üìã Return Instructions</h3>
  <ol style="padding-left:1.2rem;color:#555;line-height:2;">
    <li>Keep the item safe and secure</li>
    <li>Contact the owner using the info above, or submit a report below</li>
    <li>If on campus, you can also drop it at the lost-and-found office</li>
  </ol>
</section>

<section class="card narrow">
  <div class="center-text" style="margin-bottom:1rem;">
    <h3>‚úâÔ∏è Send a Message to the Owner</h3>
    <p style="color:#888;font-size:0.85rem;">Let them know you found their item</p>
  </div>
  <form id="qr-report-form" method="post" action="/found/<%= item.token %>">
    <label>Your name <input name="finder_name" required placeholder="Your full name" /></label>
    <label>Your email <input type="email" name="finder_email" required placeholder="you@email.com" /></label>
    <label>Where did you find it? <small style="font-weight:400;color:#aaa;">(optional)</small> <input name="location_hint" placeholder="e.g. Library 2nd floor, Cafeteria" /></label>
    <label>Message <textarea name="message" rows="4" required placeholder="Hi! I found your item at..."></textarea></label>
    <button type="submit" class="btn-success">Send Report to Owner</button>
  </form>
</section>

<!-- Report Confirmation Modal -->
<div id="qr-confirm-modal" class="modal-overlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="qr-modal-title">
  <div class="modal-box">
    <button type="button" class="modal-close" id="qr-modal-close" aria-label="Close">&times;</button>
    <div style="text-align:center;margin-bottom:1rem;font-size:2rem;">&#128140;</div>
    <h3 id="qr-modal-title" style="text-align:center;margin-bottom:0.5rem;">Send Report to Owner?</h3>
    <p style="text-align:center;color:#666;font-size:0.9rem;margin-bottom:1.5rem;">The owner will be notified that you found their item.</p>
    <div style="display:flex;gap:0.7rem;">
      <button type="button" id="qr-modal-cancel" class="button btn-outline" style="flex:1;">Cancel</button>
      <button type="button" id="qr-modal-confirm" class="button btn-success" style="flex:1;">&#10003; Yes, Send Report</button>
    </div>
  </div>
</div>

<script>
  (function () {
    var form = document.getElementById('qr-report-form');
    var modal = document.getElementById('qr-confirm-modal');
    var confirmBtn = document.getElementById('qr-modal-confirm');
    var cancelBtn = document.getElementById('qr-modal-cancel');
    var closeBtn = document.getElementById('qr-modal-close');

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      modal.style.display = 'flex';
      confirmBtn.focus();
    });

    function closeModal() { modal.style.display = 'none'; }

    confirmBtn.addEventListener('click', function () { modal.style.display = 'none'; form.submit(); });
    cancelBtn.addEventListener('click', closeModal);
    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', function (e) { if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', function (e) { if (e.key === 'Escape') closeModal(); });
  })();
</script>

<%- include('_footer') %>
